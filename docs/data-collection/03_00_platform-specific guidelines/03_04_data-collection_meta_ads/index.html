<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-data-collection/03_00_platform-specific guidelines/03_04_data-collection_meta_ads" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Data Collection of Facebook and Instagram Ads | Data Knowledge Hub for Researching Online Discourse</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.data-knowledge-hub.com/docs/data-collection/03_00_platform-specific guidelines/03_04_data-collection_meta_ads"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Data Collection of Facebook and Instagram Ads | Data Knowledge Hub for Researching Online Discourse"><meta data-rh="true" name="description" content="&lt;AuthorCard"><meta data-rh="true" property="og:description" content="&lt;AuthorCard"><link data-rh="true" rel="icon" href="/img/dkh_logo.png"><link data-rh="true" rel="canonical" href="https://www.data-knowledge-hub.com/docs/data-collection/03_00_platform-specific guidelines/03_04_data-collection_meta_ads"><link data-rh="true" rel="alternate" href="https://www.data-knowledge-hub.com/docs/data-collection/03_00_platform-specific guidelines/03_04_data-collection_meta_ads" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.data-knowledge-hub.com/docs/data-collection/03_00_platform-specific guidelines/03_04_data-collection_meta_ads" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e8887b71.css">
<script src="/assets/js/runtime~main.1ed8ba9a.js" defer="defer"></script>
<script src="/assets/js/main.935083f8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/dkh_logo_text.svg" alt="Data Knowledge Hub Logo" class="logo themedComponent_mlkZ themedComponent--light_NVdE" height="10px"><img src="/img/dkh_logo_text.svg" alt="Data Knowledge Hub Logo" class="logo themedComponent_mlkZ themedComponent--dark_xIcU" height="10px"></div></a><a href="#about" class="navbar__item navbar__link">About</a><a href="#hub" class="navbar__item navbar__link">Knowledge Base</a><a href="#contribute" class="navbar__item navbar__link">Why contribute?</a><a href="#team" class="navbar__item navbar__link">Who is behind it?</a></div><div class="navbar__items navbar__items--right"><a href="https://upgradedemocracy.de/en/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Initiators<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/background-rationale">What is the Data Knowledge Hub?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/get-started/">Getting started</a><button aria-label="Expand sidebar category &#x27;Getting started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/data-access/">Data access and permissions</a><button aria-label="Expand sidebar category &#x27;Data access and permissions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/data-collection/">Data collection methods</a><button aria-label="Collapse sidebar category &#x27;Data collection methods&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-collection/03_01_data-types">Social media data types: An overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-collection/03_02_data-collection-methods">Common data collection methods</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/data-collection/03_00_platform-specific guidelines/twitter/">Platform-specific guidelines</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/data-collection/03_00_platform-specific guidelines/twitter/">Data Collection on X (Twitter)</a><button aria-label="Expand sidebar category &#x27;Data Collection on X (Twitter)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-collection/03_00_platform-specific guidelines/03_00_data-collection_youtube">Data Collection on YouTube</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-collection/03_00_platform-specific guidelines/03_01_data-collection_rumble">Data Collection on Rumble</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/data-collection/03_00_platform-specific guidelines/03_04_data-collection_meta_ads">Data Collection of Facebook and Instagram Ads</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-collection/03_03_web-scraping-intro">Webscraping</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/data-analysis/">Data analysis projects</a><button aria-label="Expand sidebar category &#x27;Data analysis projects&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/literature/">Research resources</a><button aria-label="Expand sidebar category &#x27;Research resources&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/contribute/06_01_how-to-contribute">Community and support</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg width="16" height="16" viewBox="5 1 30 34" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M30.7422 16.2334V30.7428C30.7422 31.4424 30.4643 32.1134 29.9696 32.6082C29.4748 33.1029 28.8038 33.3808 28.1042 33.3808H12.2758C11.5761 33.3808 10.9051 33.1029 10.4104 32.6082C9.91563 32.1134 9.6377 31.4424 9.6377 30.7428V16.2334" stroke="#B3B3B3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path><path d="M7 18.3437L20.1903 7L33.3807 18.3437" stroke="#B3B3B3" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/data-collection/"><span itemprop="name">Data collection methods</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Platform-specific guidelines</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Data Collection of Facebook and Instagram Ads</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Data Collection of Facebook and Instagram Ads</h1></header><div style="display:inline-block;background-color:#1144A4;color:#fff;border-radius:25px;padding-top:5px;padding-bottom:5px;padding-left:15px;padding-right:15px;font-size:14px;font-weight:600;margin:5px">Level: <!-- -->Intermediate</div>
<div style="display:inline-block;background-color:#1EB4FF;color:black;border-radius:25px;padding-top:5px;padding-bottom:5px;padding-left:15px;padding-right:15px;font-size:14px;font-weight:600;margin:5px">Platform: <!-- -->Meta</div>
<div style="display:inline-block;background-color:#73F19C;color:black;border-radius:25px;padding-top:5px;padding-bottom:5px;padding-left:15px;padding-right:15px;font-size:14px;font-weight:600;margin:5px">Language: <!-- -->R</div>
<div style="display:flex;align-items:center;color:#000;background-color:#fff;border-radius:5px;padding:10px;margin-bottom:10px"><div style="width:2px;height:50px;background-color:#000;margin-right:10px"></div><div style="color:#fff;padding:2px;display:none;justify-content:center;align-items:center;background-color:#2C60AD;border-radius:100%;width:50px;height:50px;font-weight:600"> <!-- -->FV</div><img style="vertical-align:middle;width:50px;height:50px;border-radius:50%" src="/assets/images/votta-efa52a1637cf5ac9d2c3d87490fc1e4f.jpg"><div style="padding-left:10px"><div style="font-weight:bold">Fabio Votta</div><div style="font-size:14px">ASCoR | University of Amsterdam</div><div style="font-size:14px"><a style="display:inline;margin-left:2px" href="https://www.favstats.eu/" target="_blank">Website </a><a style="display:none;margin-left:2px" target="_blank">Twitter / X </a><a style="display:none;margin-left:2px" target="_blank">Mastodon </a><a style="display:none;margin-left:2px" target="_blank">Google Scholar </a><a style="display:inline;margin-left:2px" href="https://www.linkedin.com/in/dr-fabio-votta-81a862131" target="_blank">LinkedIn </a><a style="display:inline;margin-left:2px" href="https://bsky.app/profile/favstats.eu" target="_blank">Bluesky </a></div></div></div>
<div style="width:100%"><div style="display:inline-block;text-align:left;color:#000000;padding-top:0px;padding-bottom:20px;padding-left:0px;font-size:12px;font-weight:500;margin:0px;width:100%"><img src="/img/icon-edit.svg" style="height:12px"> <!-- -->Original post on 30.07.2025 by Fabio Votta<br></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>Meta’s Ad Library provides a public record of ads that run on Facebook
and Instagram. Researchers, journalists, and civic watchdogs can use
this data to analyze advertising trends, for example, tracking political
campaign ads, spending, and the reached demographics. The Meta Ad
Library API offers programmatic access to these ads, enabling retrieval
of detailed ad content and performance information. Each ad entry
includes metadata such as the ad’s text, the advertiser’s page, the time
period it ran, the amount spent (as a range), impressions delivered
(also as a range), and breakdowns of the audience by age, gender, and
region. Importantly, many metrics are given as ranges (min–max) rather
than precise values.</p>
<p>This tutorial will demonstrate how to use R (with
the <code>tidyverse</code> ecosystem) and the <code>Radlibrary</code> R package to access the
Meta Ad Library via its official API. We will walk through obtaining API
access, constructing queries to find ads (by keyword or page id),
retrieving ad data, and performing analyses such as ad volume and spend
over time, top advertisers, and demographic targeting patterns.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-setting-up-api-access-verification--developer-account">Step 1: Setting Up API Access (Verification &amp; Developer Account)<a href="#step-1-setting-up-api-access-verification--developer-account" class="hash-link" aria-label="Direct link to Step 1: Setting Up API Access (Verification &amp; Developer Account)" title="Direct link to Step 1: Setting Up API Access (Verification &amp; Developer Account)">​</a></h3>
<p>Before writing any code, you need to secure access to the Ad Library
API. Meta requires a few one-time setup steps:</p>
<ol>
<li><strong>Confirm your identity and location</strong>: Facebook mandates an <a href="https://www.facebook.com/id/hub" target="_blank" rel="noopener noreferrer">ID
verification process</a> for anyone
accessing political ad data (the same process required to run
political ads). You will need to provide a government ID and proof
of your country. This can take 1–2 days for approval.</li>
</ol>
<p><img decoding="async" loading="lazy" src="/assets/images/signup-27e08a57c0ef83e71ebc62a7acea1720.png" width="1580" height="924" class="img_ev3q"></p>
<ol start="2">
<li>
<p><strong>Create a Facebook Developer account</strong>: Go to the Facebook for
Developers portal and sign up with your Facebook account (if you
haven’t already). Agree to any platform policies as needed. Once you
have a developer account, create a new “App” in the dashboard
(choose Business or Custom app type for this
purpose). This app is just a container to obtain API credentials.</p>
</li>
<li>
<p><strong>Generate an access token</strong>: The Ad Library API is accessed via
Meta’s Graph API. The simplest way to get a token is by using the
<a href="https://developers.facebook.com/tools/explorer" target="_blank" rel="noopener noreferrer">Graph API Explorer</a>
tool. Once you are on the Graph API Explorer page, generate a user
access token. You need to add the permission <code>ads_read</code> in the token
generation dialog so that the token is authorized to query the ads
archive. Once generated, copy this token for use in R. Keep it
confidential and treat it like a password – anyone with this token
could potentially query the API on your behalf until it expires.</p>
</li>
</ol>
<div style="border:solid #1EB4FF;background:linear-gradient(262.38deg, #90E5FC 8.76%, #E3F8FE 96.47%);padding:25px;margin-bottom:15px;border-radius:10px"><div style="display:flex;align-items:center;min-height:22px;margin-bottom:12px"><img src="/img/icons/note.svg" alt="Note Icon" style="margin-right:10px;height:100%"><h5 style="font-size:20px;margin:0">Note</h5></div><div><p><strong>Token expiration:</strong> By default, tokens from the Explorer are <a href="https://developers.facebook.com/docs/facebook-login/guides/access-tokens#termtokens" target="_blank" rel="noopener noreferrer">short-lived</a>(usually ~1-2 hours). For short analysis sessions that might be
sufficient, but in most cases you will likely need longer access. You can exchange the short-lived token for a 60-day token using your App’s App ID and App Secret. In this tutorial, we will proceed with a short-lived token for simplicity, but it is strongly encouraged to get a long-term token for your analysis (holds for 60 days). For instructions on how to do this, refer to the <a href="https://facebookresearch.github.io/Radlibrary/articles/Radlibrary.html#generating-persistent-tokens" target="_blank" rel="noopener noreferrer">official Meta documentation on access tokens</a>.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-installing-and-loading-r-packages">Step 2: Installing and Loading R Packages<a href="#step-2-installing-and-loading-r-packages" class="hash-link" aria-label="Direct link to Step 2: Installing and Loading R Packages" title="Direct link to Step 2: Installing and Loading R Packages">​</a></h3>
<p>We will use an R package called <code>Radlibrary</code> (by Meta’s Facebook
Research team) to interact with the Ad Library API. <code>Radlibrary</code> is a
convenient wrapper that handles authentication and query construction,
saving us from crafting raw Graph API calls (which we could also do if
we feel fancy like that). It also helps format results into tidy data
frames. In addition, we will use the <code>tidyverse</code> for data manipulation
(<code>dplyr</code>, <code>tidyr</code>) and <code>ggplot2</code> for visualization. Finally, we will use
my very own package,
<a href="/docs/data-collection/03_00_platform-specific guidelines/www.github.com/favstats/metatargetr"><code>metatargetr</code></a> to retrieve some ad
spending data. If you haven’t installed these packages, do so first:</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Install Radlibrary from GitHub (it’s not on CRAN as of writing)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;pak&quot;</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%in%</span><span class="token plain"> installed.packages</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install.packages</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;pak&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># if devtools not already installed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Install Radlibrary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pak</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">pak</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;facebookresearch/Radlibrary&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install metatargetr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pak</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">pak</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;favstats/metatargetr&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install lubridate </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pak</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">pak</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;lubridate&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Install tidyverse if not already (includes dplyr, ggplot2, etc.)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pak</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">pak</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tidyverse&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Load the libraries in your R session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Radlibrary</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metatargetr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lubridate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># for convenient date functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tidyverse</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Make sure <code>Radlibrary</code> installed successfully (you might need to update
Rtools on Windows or install additional library on Linux distributions).
Now you are ready to use the Meta Ad Library API in R!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-authenticating-with-your-access-token">Step 3: Authenticating with your Access Token<a href="#step-3-authenticating-with-your-access-token" class="hash-link" aria-label="Direct link to Step 3: Authenticating with your Access Token" title="Direct link to Step 3: Authenticating with your Access Token">​</a></h3>
<p>With your user access token in hand (from Step 1), you need to provide
it to <code>Radlibrary</code> so it can authenticate API requests. <strong>As a general
rule, never hard-code the token directly in scripts.</strong> One safe approach
is to use R’s readline() function to paste the token interactively (this
avoids storing it in your R command history):</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Prompt for the token (paste your token string at the prompt that appears)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">token </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> readline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prompt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Enter your Facebook API access token: &quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When you run this, R will pause and let you paste the token. Hit Enter
and it will be stored in the token variable for use. This method ensures
the token is not visible in your script or R history.</p>
<p><strong>Optionally:</strong></p>
<p>You can also save the token as an environment variable like this:</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Set the token as an environment variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sys.setenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">META_API_TOKEN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, in the rest of your script, you can retrieve your token like this
<em>but only after you have restarted your R session</em>:</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">token </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> Sys.getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;META_API_TOKEN&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="querying-the-ad-library-api">Querying the Ad Library API<a href="#querying-the-ad-library-api" class="hash-link" aria-label="Direct link to Querying the Ad Library API" title="Direct link to Querying the Ad Library API">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-building-a-query-to-the-ad-library-api-adlib_build_query">Step 4: Building a Query to the Ad Library API (<code>adlib_build_query</code>)<a href="#step-4-building-a-query-to-the-ad-library-api-adlib_build_query" class="hash-link" aria-label="Direct link to step-4-building-a-query-to-the-ad-library-api-adlib_build_query" title="Direct link to step-4-building-a-query-to-the-ad-library-api-adlib_build_query">​</a></h3>
<p>Now we get to the moment we have been waiting for – how to get the data!
The Ad Library API requires specifying what ads you want to retrieve.
This is done by constructing a query with various parameters. The
<code>Radlibrary</code> function <code>adlib_build_query()</code> helps create this query
object.</p>
<p>We will start with a simple example scenario: Suppose we want to find
ads related to the climate in the runup to the 2025 German parliamentary
elections. We are interested in all such ads (whether currently active
or inactive) that were shown three weeks before election day but only
those that were classified or self-identified as political or issue ads.</p>
<p>First, we specifiy a list of all the variables that we would like to
retrieve, here I use all available variables as of June 2025.</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## First we </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ad_fields </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">## some meta info and unique identifier</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;page_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;page_name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token comment" style="color:#999988;font-style:italic"># &quot;id&quot;, # id is added automatically</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">## general info, text, description, run times</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;ad_creation_time&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ad_delivery_start_time&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ad_delivery_stop_time&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;ad_creative_bodies&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ad_creative_link_captions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ad_creative_link_descriptions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;ad_creative_link_titles&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;ad_snapshot_url&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;languages&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;publisher_platforms&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">## spending info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;currency&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;spend&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bylines&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;beneficiary_payers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">## delivery and reach</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;delivery_by_region&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;demographic_distribution&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;estimated_audience_size&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;impressions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># &quot;br_total_reach&quot;, # unique reach (only available for Brazil)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">## EU only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;eu_total_reach&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;age_country_gender_reach_breakdown&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;target_ages&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;target_gender&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;target_locations&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now we are ready to build the query step by step:</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Build an Ad Library API query for ads related to &quot;climate&quot; in Germany during 2025 election</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">query </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> adlib_build_query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ad_reached_countries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># country where ads were delivered</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ad_delivery_date_min </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-02-03&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># specify minimum date: 21 days before election day</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ad_delivery_date_max </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-02-23&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># specify maximum date: election day</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ad_active_status    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ALL&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># include both active and inactive ads </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  search_terms        </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;klima&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># keywords to search in ad text or metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ad_type             </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;POLITICAL_AND_ISSUE_ADS&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># restrict to political/issue ads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fields              </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ad_fields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># data fields we want</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  limit               </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># number of results per page (max 1000)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div style="border:solid #1EB4FF;background:linear-gradient(262.38deg, #90E5FC 8.76%, #E3F8FE 96.47%);padding:25px;margin-bottom:15px;border-radius:10px"><div style="display:flex;align-items:center;min-height:22px;margin-bottom:12px"><img src="/img/icons/note.svg" alt="Note Icon" style="margin-right:10px;height:100%"><h5 style="font-size:20px;margin:0">Note</h5></div><div><p>You might encounter the following warning: <em>Warning: Unsupported fields supplied:</em> followed by a list of parameters. This warning can be safely ignored. The <code>Radlibrary</code> package, despite being developed by the Facebook team, may not be up to date with the newest parameters.</p></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="parameter-breakdown">Parameter Breakdown<a href="#parameter-breakdown" class="hash-link" aria-label="Direct link to Parameter Breakdown" title="Direct link to Parameter Breakdown">​</a></h4>
<p>Let us unpack the parameters used in the API query (and some additional
ones):</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong><code>ad_reached_countries</code></strong><br>
<!-- -->Specifies the countries where the ads were delivered.</summary><div><div class="collapsibleContent_i85q"><p>For example, setting this to <code>&quot;DE&quot;</code> retrieves ads delivered in
Germany.<br>
<!-- -->At least one country code must be specified. Multiple countries can be
provided as a vector, e.g., <code>c(&quot;US&quot;, &quot;CA&quot;)</code>.</p></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong><code>ad_delivery_date_min</code></strong> and  <strong><code>ad_delivery_date_max</code></strong><br>
<!-- -->Define the date range for when the ads were delivered.</summary><div><div class="collapsibleContent_i85q"><p>The format should be <code>&quot;YYYY-MM-DD&quot;</code>.<br>
<!-- -->For instance, setting <code>ad_delivery_date_min = &quot;2025-02-22&quot;</code> and<br>
<code>ad_delivery_date_max = &quot;2025-02-23&quot;</code> retrieves ads delivered between<br>
<!-- -->February 22 and February 23, 2025.</p></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> <strong><code>ad_active_status</code></strong> determines the delivery status of the ads to retrieve.</summary><div><div class="collapsibleContent_i85q"><p>If not specified, the default is <code>&quot;ACTIVE&quot;</code>, which returns only<br>
<!-- -->currently active ads.<br>
<!-- -->For historical analysis, setting this to <code>&quot;ALL&quot;</code> retrieves both active<br>
<!-- -->and inactive ads.</p><p>Valid values:</p><ul>
<li><code>&quot;ALL&quot;</code>: all ads, past and present</li>
<li><code>&quot;ACTIVE&quot;</code>: only currently running ads</li>
<li><code>&quot;INACTIVE&quot;</code>: only ads that have stopped running</li>
</ul></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> <strong><code>search_terms</code></strong> is a keyword or phrase to search within the ad’s content, title, or disclaimer text.</summary><div><div class="collapsibleContent_i85q"><p>The API treats a blank space as a logical <code>AND</code> and searches for both<br>
<!-- -->terms without other operators.<br>
<!-- -->For example, <code>&quot;climate change&quot;</code> is interpreted as <code>&quot;climate&quot;</code> AND<br>
<code>&quot;change&quot;</code>.<br>
<!-- -->To search for an exact phrase, use the <code>search_type</code> parameter set to<br>
<code>&quot;KEYWORD_EXACT_PHRASE&quot;</code>.</p></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> <strong><code>search_page_ids</code></strong> is an optional alternative to <code>search_terms</code> and retrieves ads from a specific Facebook Page.</summary><div><div class="collapsibleContent_i85q"><p>Provide the numeric Page ID (e.g., <code>&quot;1234567890&quot;</code>).<br>
<!-- -->This is ideal when focusing on a particular advertiser’s metadata and<br>
<!-- -->content.</p><p>You can find page IDs via:</p><ul>
<li>The Ad Library API (just query it by <code>search_terms</code> as we show below and take note of a page id of interest).</li>
<li>Download spending reports in the <a href="https://www.facebook.com/ads/library/report/" target="_blank" rel="noopener noreferrer">Ad Library Report</a> which includes spending by page id.</li>
<li>In the URL of an Ad Library page, i.e. after the <code>view_all_page_id</code> URL parameter. For example:<br>
<a href="https://www.facebook.com/ads/library/?view_all_page_id=179587888720522" target="_blank" rel="noopener noreferrer">https://www.facebook.com/ads/library/?view_all_page_id=179587888720522</a> is the Ad Library Page for the U.S. Department of Homeland Security and <em>179587888720522</em> is the page id.</li>
</ul></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> <strong><code>ad_type</code></strong> specifies the category of ads to retrieve.</summary><div><div class="collapsibleContent_i85q"><p>Valid values include:</p><ul>
<li><code>&quot;ALL&quot;</code>: Retrieves all ads, regardless of category.</li>
<li><code>&quot;POLITICAL_AND_ISSUE_ADS&quot;</code></li>
<li><code>&quot;EMPLOYMENT_ADS&quot;</code></li>
<li><code>&quot;HOUSING_ADS&quot;</code></li>
<li><code>&quot;FINANCIAL_PRODUCTS_AND_SERVICES_ADS&quot;</code></li>
</ul></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> <strong><code>fields</code></strong> determines what information about each ad will be returned.</summary><div><div class="collapsibleContent_i85q"><p>In our example, we request specific fields defined in the <code>ad_fields</code><br>
<!-- -->variable.<br>
<!-- -->The fields are categorized as follows:</p><ul>
<li><strong>Meta Information and Identifiers</strong>:<!-- -->
<ul>
<li><code>&quot;page_id&quot;</code>: Unique identifier for the Facebook Page.</li>
<li><code>&quot;page_name&quot;</code>: Name of the Facebook Page.</li>
</ul>
</li>
<li><strong>General Information</strong>:<!-- -->
<ul>
<li><code>&quot;ad_creation_time&quot;</code>: Time when the ad was created.</li>
<li><code>&quot;ad_delivery_start_time&quot;</code>: Start time of the ad delivery.</li>
<li><code>&quot;ad_delivery_stop_time&quot;</code>: Stop time of the ad delivery.</li>
<li><code>&quot;ad_creative_bodies&quot;</code>: Main text content of the ad.</li>
<li><code>&quot;ad_creative_link_captions&quot;</code>: Captions in the call-to-action section.</li>
<li><code>&quot;ad_creative_link_descriptions&quot;</code>: Descriptions in the call-to-action section.</li>
<li><code>&quot;ad_creative_link_titles&quot;</code>: Titles in the call-to-action section.</li>
<li><code>&quot;ad_snapshot_url&quot;</code>: URL to a snapshot of the ad.</li>
<li><code>&quot;languages&quot;</code>: Languages used in the ad.</li>
<li><code>&quot;publisher_platforms&quot;</code>: Platforms where the ad was published (e.g., Facebook, Instagram).</li>
</ul>
</li>
<li><strong>Spending Information</strong>:<!-- -->
<ul>
<li><code>&quot;currency&quot;</code>: Currency used for the ad spend.</li>
<li><code>&quot;spend&quot;</code>: Amount spent on the ad.</li>
<li><code>&quot;bylines&quot;</code>: Bylines associated with the ad.</li>
<li><code>&quot;beneficiary_payers&quot;</code>: Entities that paid for the ad.</li>
</ul>
</li>
<li><strong>Delivery and Reach</strong>:<!-- -->
<ul>
<li><code>&quot;delivery_by_region&quot;</code>: Regional delivery information.</li>
<li><code>&quot;demographic_distribution&quot;</code>: Demographic breakdown of the ad’s audience.</li>
<li><code>&quot;estimated_audience_size&quot;</code>: Estimated size of the audience.</li>
<li><code>&quot;impressions&quot;</code>: Number of times the ad was displayed.</li>
</ul>
</li>
<li><strong>EU-Specific Fields</strong>:<!-- -->
<ul>
<li><code>&quot;eu_total_reach&quot;</code>: Total reach within the European Union.</li>
<li><code>&quot;age_country_gender_reach_breakdown&quot;</code>: Breakdown of reach by age, country, and gender.</li>
<li><code>&quot;target_ages&quot;</code>: Targeted age groups.</li>
<li><code>&quot;target_gender&quot;</code>: Targeted genders.</li>
<li><code>&quot;target_locations&quot;</code>: Targeted locations.</li>
</ul>
</li>
</ul><p>These fields provide comprehensive information about each ad, including<br>
<!-- -->its content, delivery, and audience targeting. For more info, you can<br>
<!-- -->check the <a href="https://www.facebook.com/ads/library/api/" target="_blank" rel="noopener noreferrer">Meta Ad Library API documentation</a>.</p></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> <strong><code>limit</code></strong> limits the number of results per API call.</summary><div><div class="collapsibleContent_i85q"><p>The default value is 25, and the maximum is 1,000.<br>
<!-- -->If your query could return more, you will need to paginate (more about<br>
<!-- -->that later).<br>
<!-- -->For now, we assume <code>100</code> is sufficient for demonstration purposes.</p></div></div></details>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="next-step">Next Step<a href="#next-step" class="hash-link" aria-label="Direct link to Next Step" title="Direct link to Next Step">​</a></h4>
<p>At this point, we have only created a <strong>query object</strong>, a structured
list containing all parameters. <strong>The query has not yet been sent</strong> to
Meta.</p>
<p>The function <code>adlib_build_query()</code> only constructs the query. You can
inspect it by printing <code>query</code>, which will show its components and the
exact URL to be called.</p>
<p>Let us now proceed to <strong>fetch the data</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-retrieving-ad-data-from-the-api-adlib_get">Step 5: Retrieving Ad Data from the API (<code>adlib_get</code>)<a href="#step-5-retrieving-ad-data-from-the-api-adlib_get" class="hash-link" aria-label="Direct link to step-5-retrieving-ad-data-from-the-api-adlib_get" title="Direct link to step-5-retrieving-ad-data-from-the-api-adlib_get">​</a></h3>
<p>To execute the query and get results, we use <code>Radlibrary</code>’s function
<code>adlib_get()</code>. This function takes our query and the access token, sends
the request to Meta’s Graph API, and returns the response. Let’s call
it:</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Execute the query and retrieve data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">result </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> adlib_get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Under the hood, this hits the Graph API’s /ads_archive endpoint with all
the parameters we specified. The result we get back is an object of
class <code>adlib_data_response</code>. It contains the data and some metadata.</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">glimpse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token operator" style="color:#393A34">$</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max.level </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">     $ id                                : chr &quot;547343151714655&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ page_id                           : chr &quot;530858850114749&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ page_name                         : chr &quot;Undone Work GmbH&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ ad_creation_time                  : chr &quot;2025-02-23&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ ad_delivery_start_time            : chr &quot;2025-02-23&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ ad_delivery_stop_time             : chr &quot;2025-02-28&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ ad_creative_bodies                :List of 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ ad_creative_link_captions         :List of 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ ad_snapshot_url                   : chr &quot;https://www.facebook.com/ads/archive/render_ad/?id=547343151714655&amp;access_token=XXXX&quot;| __truncated__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ languages                         :List of 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ publisher_platforms               :List of 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ currency                          : chr &quot;EUR&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ spend                             :List of 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ bylines                           : chr &quot;Undone Work GmbH&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ beneficiary_payers                :List of 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ delivery_by_region                :List of 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ demographic_distribution          :List of 15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ estimated_audience_size           :List of 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ impressions                       :List of 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ eu_total_reach                    : int 616</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ age_country_gender_reach_breakdown:List of 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ target_ages                       :List of 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ target_gender                     : chr &quot;All&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     $ target_locations                  :List of 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now that result is in hand, let’s convert it into a more
analysis-friendly format.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-6-converting-to-a-tidy-data-frame">Step 6: Converting to a Tidy Data Frame<a href="#step-6-converting-to-a-tidy-data-frame" class="hash-link" aria-label="Direct link to Step 6: Converting to a Tidy Data Frame" title="Direct link to Step 6: Converting to a Tidy Data Frame">​</a></h3>
<p>Radlibrary provides an S3 method to turn the result into a tibble (a
tidyverse-friendly data frame). We simply use as_tibble():</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ads_df </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> as_tibble</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> censor_access_token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">TRUE</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By default, we include <code>censor_access_token = TRUE</code> to strip out the
token from any embedded URLs in the data (this is a safety measure so we
don’t accidentally reveal our token when inspecting data). Now <code>ads_df</code>
is a tibble where each row is one ad and each column is a variable
returned by the API.</p>
<p>If you want to check the columns, try <code>glimpse(ads_df)</code> or
<code>names(ads_df)</code> to inspect the structure of the <code>ads_df</code> data frame.
Some of the key columns include: - <code>impressions_lower</code>,
<code>impressions_upper</code>: The estimated range of impressions delivered. -
<code>spend_lower</code>, <code>spend_upper</code>: The estimated range of ad spend in the
currency used - <code>demographic_distribution</code>: A so-called list-column
containing, for each ad, a data frame of demographic percentages (since
we asked for it). We will explore how to work with this column in Step
9.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-7-handling-pagination-for-larger-datasets-paginate_meta_api">Step 7: Handling Pagination for Larger Datasets (<code>paginate_meta_api</code>)<a href="#step-7-handling-pagination-for-larger-datasets-paginate_meta_api" class="hash-link" aria-label="Direct link to step-7-handling-pagination-for-larger-datasets-paginate_meta_api" title="Direct link to step-7-handling-pagination-for-larger-datasets-paginate_meta_api">​</a></h3>
<p>The Meta Ad Library API returns only a limited number of ads per
request. To retrieve more than the default amount, you need to handle
pagination by following the <code>next_page</code> links provided in the API
response.</p>
<p>While the <code>Radlibrary</code> package offers the <code>adlib_get_paginated()</code>
function to assist with pagination, it unfortunately does NOT handle
rate limiting or delays between requests. To address this, I have
implemented a custom function, <code>paginate_meta_api()</code>, which automates
pagination and includes logic to manage API rate limits by introducing
appropriate delays between requests. Specify <code>max_pages</code>, i.e. how many
iterations you want to go through and also whether it should print
update while retrieving data <code>verbose = TRUE</code>, and API usage limits
<code>api_health = TRUE</code> (by default <code>FALSE</code>).</p>
<p>Here is how you can use the custom function:</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Load the custom pagination function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://gist.githubusercontent.com/favstats/ac37f6a7c881dddfa1c156bfb3e2dbdf/raw/b49e3f73881a4595309480e418658e018fbd0980/paginate_meta_api.R&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Retrieve all pages with delay logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">climate_ads </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> paginate_meta_api</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_pages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> verbose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">FALSE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> api_health </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">FALSE</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>At this stage, we have a data frame <code>climate_ads</code> of all retrieved ads
and their metadata. We can now perform analysis on this data. Let us
tackle a few common analysis tasks one by one.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analzing-the-data">Analzing the Data<a href="#analzing-the-data" class="hash-link" aria-label="Direct link to Analzing the Data" title="Direct link to Analzing the Data">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-8-analyzing-ad-volume-and-top-advertisers">Step 8: Analyzing Ad Volume and Top Advertisers<a href="#step-8-analyzing-ad-volume-and-top-advertisers" class="hash-link" aria-label="Direct link to Step 8: Analyzing Ad Volume and Top Advertisers" title="Direct link to Step 8: Analyzing Ad Volume and Top Advertisers">​</a></h3>
<p>A basic question is how the number of ads changes
over time. For example, did advertising surge closer to election day? We
can visualize the number of ads in our dataset by date by using the ad
delivery start date as the date an ad “entered” the library (since if an
ad is active for multiple days, it is counted on the first day it ran).
Let us create a time series of ad count by day:</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">climate_ads </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mutate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start_date </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> as.Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ad_delivery_start_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># extract date portion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start_date</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ggplot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> start_date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  geom_line</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">color </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;steelblue&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Date&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Number of Ads Started&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Daily Count of New Ads in Ad Library (\&quot;climate\&quot; query in Germany)&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  theme_minimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/unnamed-chunk-15-1-0d708b01ac80280a4fb2aa2bb89dd48c.png" width="2400" height="1800" class="img_ev3q"></p>
<p>This code groups ads by their start date and counts them, then plots a
line graph. The result shows that we retrieved much more data than we
had specified. This sometimes happens – the API is not perfect. We
filter to include only data within the specified timeframe.</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">climate_ads </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mutate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start_date </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> as.Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ad_delivery_start_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># extract date portion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start_date</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start_date </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> as.Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;2025-02-03&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ggplot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> start_date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  geom_line</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">color </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;darkgreen&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Date&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Number of Ads Started&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Daily Count of New Ads in Ad Library (\&quot;climate\&quot; query in Germany)&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  theme_minimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/unnamed-chunk-16-1-baa7e4b702993c6817a2325b627879b5.png" width="2400" height="1800" class="img_ev3q"></p>
<p>Another limitation with counting ads is that the ads listed in the ad
library do not represent unique ads, but rather ad runs. If an
advertiser runs the same ad again with some changes in settings, it will
be counted as a separate ad. This may overinflate the number of unique
ads. One possible way to address this is to filter for unique texts
(e.g. <code>ad_creative_bodies</code>).</p>
<p>Another approach is to aggregate by spending, which gives a sense of
where the advertiser’s focus lies.</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">climate_ads </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mutate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">keyword </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;climate&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mutate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start_date </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> as.Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ad_delivery_start_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># extract date portion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  group_by</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start_date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">keyword</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  summarize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spend_lower </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spend_lower</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spend_upper </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spend_upper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ungroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rowwise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mutate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spend_mid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> median</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spend_lower</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spend_upper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">start_date </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> as.Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;2025-02-03&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ggplot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> start_date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spend_mid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> keyword</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  geom_ribbon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ymin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spend_lower</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ymax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spend_upper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> alpha </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> linetype </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blank&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  geom_line</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Date&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Daily Ad Spending in Euro&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Daily Spending on Ads in Ad Library (\&quot;climate\&quot; query in Germany)&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  theme_minimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scale_color_manual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">values </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;darkgreen&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  theme</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">legend.position </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bottom&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/unnamed-chunk-17-1-ba47f11b43efbb78621d46e9c52986be.png" width="2400" height="1800" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="who-is-advertising-on-the-climate-topic">Who is advertising on the climate topic?<a href="#who-is-advertising-on-the-climate-topic" class="hash-link" aria-label="Direct link to Who is advertising on the climate topic?" title="Direct link to Who is advertising on the climate topic?">​</a></h4>
<p>Another common analysis is to identify which organizations or pages are
running the most ads in your data. We can easily rank advertisers by the
number of ads:</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">climate_ads  </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  group_by</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dplyr</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">summarize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spend_upper </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spend_upper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ungroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  arrange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">desc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">spend_upper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  slice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mutate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">fct_reorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> spend_upper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ggplot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> page_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spend_upper</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  geom_col</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fill</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;darkgray&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  coord_flip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># flip for horizontal bars (easier to read names)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Page Name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Upper Spending Boundary&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Top 20 Advertisers in \&quot;Climate\&quot; Ad Dataset&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  theme_minimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/unnamed-chunk-18-1-cc2d2af08cad0723c2e5be89c422b044.png" width="864" height="480" class="img_ev3q"></p>
<p>Given that search terms sometimes are a bit unpredictable and don’t
always work as expected, we can also query the top 10 advertisers based
on spending. We can do so by retrieving the spending reports from Meta,
conveniently archived by the
<a href="/docs/data-collection/03_00_platform-specific guidelines/www.github.com/favstats/metatargetr"><code>metatargetr</code></a> package. For a full tutorial on <code>metatargetr</code> and its capabilities <a href="https://data-knowledge-hub.com/docs/data-analysis/04_05_metatargetr" target="_blank" rel="noopener noreferrer">see this tutorial</a>.</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spending_report </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> get_report_db</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;DE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeframe </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-02-23&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">national_parties </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> spending_report </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page_name </span><span class="token percent-operator operator" style="color:#393A34">%in%</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Die Linke&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SPD&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;BÜNDNIS 90/DIE GRÜNEN&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FDP&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CDU&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AfD&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Build an Ad Library API query for ads related to &quot;climate&quot; in Germany during 2025 election</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">query </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> adlib_build_query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ad_reached_countries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># country where ads were delivered</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ad_delivery_date_min </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-02-03&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># specify minimum date: 21 days before election day</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ad_delivery_date_max </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2025-02-23&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># specify maximum date: election day</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ad_active_status    </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ALL&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># include both active and inactive ads </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  search_page_ids     </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> national_parties</span><span class="token operator" style="color:#393A34">$</span><span class="token plain">page_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># search page IDs, up to 10 at once</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ad_type             </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;POLITICAL_AND_ISSUE_ADS&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># restrict to political/issue ads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fields              </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ad_fields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># data fields we want</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  limit               </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># number of results per page (max 1000)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">top_ads </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> paginate_meta_api</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> max_pages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> verbose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">TRUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> api_health </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">TRUE</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We are going to visualize some of the text included inside the ad data
by creating a <em>chatter plot</em>. For that, we also need some additional
packages listed below.</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pak</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">pak</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tidytext&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pak</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">pak</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;stopwords&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pak</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">pak</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ggrepel&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Define party colors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">party_colors </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;Die Linke&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#BE3075&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;SPD&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#E3000F&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;BÜNDNIS 90/DIE GRÜNEN&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#64A12D&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;FDP&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#FFED00&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;CDU&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#000000&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;AfD&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#009EE0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Tokenize ad texts and count word frequencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">top_ads </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unnest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ad_creative_bodies</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tidytext</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">unnest_tokens</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">word</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ad_creative_bodies</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">is.na</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">word</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  anti_join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tibble</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">word </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> stopwords</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">stopwords</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;de&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> by </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;word&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Select top 30 words per party</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> word</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sort </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">TRUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  group_by</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  top_n</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ungroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mutate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fct_relevel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 c</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Die Linke&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SPD&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   </span><span class="token string" style="color:#e3116c">&quot;BÜNDNIS 90/DIE GRÜNEN&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   </span><span class="token string" style="color:#e3116c">&quot;FDP&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CDU&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AfD&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Create the chatter plot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ggplot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> page_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> word</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> page_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># geom_point(alpha = 0.7) +</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ggrepel</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">geom_text_repel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    force </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    box.padding </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max.overlaps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">Inf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    segment.color </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">NA</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># This removes the lines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Political Party (Left to Right)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Word Frequency&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Common Words in Political Ads by Party&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scale_color_manual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">values </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> party_colors</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  theme_minimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scale_y_log10</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  theme</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">legend.position </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;none&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/unnamed-chunk-22-1-bf50607ae95f2a7bc03bebb305346594.png" width="1152" height="768" class="img_ev3q"></p>
<p>This chatter plot visualizes the most frequent words found in the ads of
Germany’s major political parties. The parties are arranged along the
x-axis according to their position on the political spectrum, from left
to right. The y-axis represents the frequency of each word on a
logarithmic scale, which helps visualize words with a wide range of
frequencies. This type of analysis allows us to quickly grasp the key
themes and messaging priorities for each party. For instance, we can
observe which topics are unique to certain parties and which are shared
across the political landscape, providing insights into their campaign
strategies and focus areas.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-9-examining-demographic-distributions">Step 9: Examining Demographic Distributions<a href="#step-9-examining-demographic-distributions" class="hash-link" aria-label="Direct link to Step 9: Examining Demographic Distributions" title="Direct link to Step 9: Examining Demographic Distributions">​</a></h3>
<p>One aspect of the Ad Library data is the audience distribution for each
ad. We requested demographic_distribution in our query, which for each
ad includes the percentage of impressions by age bracket and gender.
This data is returned as a nested list-column in our queried dataset. To analyze
it, we need to unnest that list into a usable table.</p>
<p>We can use <code>tidyr::unnest()</code> to expand the demographic distribution:</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Unnest demographic distribution into a long format data frame</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">demo_df </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> top_ads </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> page_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> demographic_distribution</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> page_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># focus on relevant columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unnest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">demographic_distribution</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">head</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">demo_df</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    ## # A tibble: 6 × 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ##   id               page_name percentage age   gender</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ##   &lt;chr&gt;            &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ## 1 2124558957977402 SPD          0.00029 18-24 female</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ## 2 2124558957977402 SPD          0.00159 18-24 male  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ## 3 2124558957977402 SPD          0.00391 25-34 female</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ## 4 2124558957977402 SPD          0.00985 25-34 male  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ## 5 2124558957977402 SPD          0.0136  35-44 female</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ## 6 2124558957977402 SPD          0.0265  35-44 male</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After unnesting, <code>demo_df</code> will have one row per demographic category
per ad. It should include the columns: id (ad id), page_name, age,
gender, and percentage. Each row might say, for example, ad X – age
18-24 – female – 0.2 (meaning 20% of ad X’s impressions were shown to
women aged 18-24). The percentages for a given ad across all age/gender
categories sum up to 100%.</p>
<div style="border:solid #73F19C;background:linear-gradient(262.38deg, #CCF7DB 8.76%, #E6FBED 96.47%);padding:25px;margin-bottom:15px;border-radius:10px"><div style="display:flex;align-items:center;min-height:22px;margin-bottom:12px"><img src="/img/icons/eye.svg" alt="Eye Icon" style="margin-right:10px;height:100%"><h5 style="font-size:20px;margin:0">Important</h5></div><div><p>If an ad did not reach a particular demographic group, it may not have an entry for that group.</p></div></div>
<p>Now, what can we learn from this? Here are a couple of insights we might
extract:</p>
<p>Which age groups are ads reaching most frequently? We can count how many
ads reached each age group. For instance, how many ads reached any
people in the 65+ category versus 18-24? If few ads have impressions in
older age groups, that suggests advertisers either target younger users
or simply fail to engage older audiences. Similarly, we could examine
how many ads target women vs. men, or the average percentage of
impressions to women vs. men.</p>
<div style="border:solid #73F19C;background:linear-gradient(262.38deg, #CCF7DB 8.76%, #E6FBED 96.47%);padding:25px;margin-bottom:15px;border-radius:10px"><div style="display:flex;align-items:center;min-height:22px;margin-bottom:12px"><img src="/img/icons/eye.svg" alt="Eye Icon" style="margin-right:10px;height:100%"><h5 style="font-size:20px;margin:0">Note of caution</h5></div><div><p>A more robust analysis would weight the data by impressions or spending. Averaging percentages across ads without doing so treats a low-reach ad the same as a high-reach one. For simplicity, however, we proceed with the unweighted approach.</p></div></div>
<p>For a quick view, we can calculate the overall gender split in relative
impressions, assuming equal weight per ad (again, caution advised):</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">demo_df </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">age </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Unknown&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gender </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;unknown&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  group_by</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">page_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> age</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gender</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  summarise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">percentage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">percentage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> .groups </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;drop&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mutate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">percentage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ifelse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gender </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;male&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">percentage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> percentage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token percent-operator operator" style="color:#393A34">%&gt;%</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ggplot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">aes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> age</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> percentage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fill </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> gender</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  geom_col</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  coord_flip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  facet_wrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">~</span><span class="token plain">page_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ncol </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scale_y_continuous</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">labels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> scales</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">percent_format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">accuracy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Age Group&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Average Percentage of Impressions&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Ad Audience Demographics by Party, Age, and Gender&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fill </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Gender&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  theme_minimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  theme</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">legend.position </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bottom&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/unnamed-chunk-24-1-2b985b172c7e985eb5e2e7d0069b7a04.png" width="2700" height="1800" class="img_ev3q"></p>
<p>In the illustrative chart above, each bar shows how many ads had at
least some impressions in that age group. We observe a trend where AfD
reaches more younger men on average, whereas Die Linke is more likely to
reach younger women. Keep in mind, this does not directly tell us the
volume of impressions, just the distribution of reach. An ad with only a
tiny fraction of impressions in 65+ would still count here. To truly
measure impression share, one would need to aggregate the percentages
weighted by each ad’s total impressions. Because the data only provides
ranges for impressions, a rough approach could be to use the midpoint of
each ad’s impression range as a weight. That level of detail is beyond
our scope here, but it is something to consider for a more rigorous
analysis.</p>
<p>In summary, the demographic data allows us to see who is being reached
by these ads. Advertisers’ choices (or the outcome of the delivery
algorithm) become visible: Are they reaching young adults more than
seniors? Are they targeting predominantly one gender? These insights are
valuable for understanding the focus and targeting strategies of
political campaigns.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>In this tutorial, we demonstrated a full workflow for accessing and
analyzing Facebook and Instagram advertising data using R and the Meta
Ad Library API. We covered everything from setting up access credentials
and verifying identity, to using the <code>Radlibrary</code> package to query the
API, and finally exploring the data with <code>tidyverse</code> tools and
visualizations. We learned how to retrieve ads by keyword or advertiser,
how to handle pagination and nested demographic data, and how to create
basic insights like time trends and top advertisers.</p>
<p>The Meta Ad Library API provides researchers to study political
advertising and how public discourse is shaped through paid messages. As
a next step, you might refine these examples: try querying a different
issue or country, dive deeper into ad content with text analysis, fetch
regional distributions to map out where ads are being seen, or correlate
spending with specific topics. You may also <a href="https://data-knowledge-hub.com/docs/data-analysis/04_05_metatargetr" target="_blank" rel="noopener noreferrer">check out my other  tutorial</a> on <code>metatargetr</code> which adds additional features not present in the Ad Library API such as retrieval of ad library reports and exact spending on specific target audiences (including detailed and custom audiences).</p>
<p>Happy researching – and may your analyses shed light on the world of
online (political) ads!</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/data-collection/03_00_platform-specific guidelines/03_01_data-collection_rumble"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Data Collection on Rumble</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/data-collection/03_03_web-scraping-intro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Webscraping</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a><ul><li><a href="#step-1-setting-up-api-access-verification--developer-account" class="table-of-contents__link toc-highlight">Step 1: Setting Up API Access (Verification &amp; Developer Account)</a></li><li><a href="#step-2-installing-and-loading-r-packages" class="table-of-contents__link toc-highlight">Step 2: Installing and Loading R Packages</a></li><li><a href="#step-3-authenticating-with-your-access-token" class="table-of-contents__link toc-highlight">Step 3: Authenticating with your Access Token</a></li></ul></li><li><a href="#querying-the-ad-library-api" class="table-of-contents__link toc-highlight">Querying the Ad Library API</a><ul><li><a href="#step-4-building-a-query-to-the-ad-library-api-adlib_build_query" class="table-of-contents__link toc-highlight">Step 4: Building a Query to the Ad Library API (<code>adlib_build_query</code>)</a></li><li><a href="#step-5-retrieving-ad-data-from-the-api-adlib_get" class="table-of-contents__link toc-highlight">Step 5: Retrieving Ad Data from the API (<code>adlib_get</code>)</a></li><li><a href="#step-6-converting-to-a-tidy-data-frame" class="table-of-contents__link toc-highlight">Step 6: Converting to a Tidy Data Frame</a></li><li><a href="#step-7-handling-pagination-for-larger-datasets-paginate_meta_api" class="table-of-contents__link toc-highlight">Step 7: Handling Pagination for Larger Datasets (<code>paginate_meta_api</code>)</a></li></ul></li><li><a href="#analzing-the-data" class="table-of-contents__link toc-highlight">Analzing the Data</a><ul><li><a href="#step-8-analyzing-ad-volume-and-top-advertisers" class="table-of-contents__link toc-highlight">Step 8: Analyzing Ad Volume and Top Advertisers</a></li><li><a href="#step-9-examining-demographic-distributions" class="table-of-contents__link toc-highlight">Step 9: Examining Demographic Distributions</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Data Knowledge Hub.</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/background-rationale">Knowledge</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contribute/06_01_how-to-contribute">Contribute</a></li><li class="footer__item"><a href="https://upgradedemocracy.de/en/imprint/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">upgrade democracy</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://upgradedemocracy.de/en/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/upgrade-democracy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/contribute/06_02_community">Contributors</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Data Knowledge Hub for Researching Online Discourse  © 2025 - The project is supported by the Bertelsmann Stiftung</div></div></div></footer></div>
</body>
</html>